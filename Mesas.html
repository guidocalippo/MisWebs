<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Mesas</title>
    <style>
        /* CSS básico para las mesas */
        .mesa {
            width: 100px;
            height: 100px;
            border: 1px solid #ccc;
            margin: 10px;
            display: inline-block;
            position: relative;
            cursor: pointer;
            text-align: center;
        }

        .libre {
            background-color: #e0f7fa;
        }

        .reservada {
            background-color: #ffeb3b;
        }

        /* Estilo para las reservas */
        .reserva {
            margin: 10px 0;
            padding: 5px;
            background-color: #ffcccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ya-vino {
            text-decoration: line-through;
        }

        .eliminar-reserva {
            cursor: pointer;
            color: red;
        }
    </style>
</head>
<body>
    <!-- Contenedor para las mesas -->
    <div id="mesas-container">
        <div class="mesa" data-nombre="Mesa 1">Mesa 1</div>
        <div class="mesa" data-nombre="Mesa 2">Mesa 2</div>
        <div class="mesa" data-nombre="Mesa 3">Mesa 3</div>
        <div class="mesa" data-nombre="Mesa 4">Mesa 4</div>
    </div>

    <!-- Contenedor de las reservas -->
    <div id="reservas-container">
        <div id="lista-reservas"></div>
        <button id="añadir-reserva">Añadir Reserva</button>
        <button id="reset-mesas">Resetear Mesas</button>
    </div>

    <!-- Firebase App -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>

    <!-- Script principal -->
    <script type="module">
        // Configuración de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC5W7h__bkfCMvnBGVXYmo-S8DDkruZqzg",
            authDomain: "reservamesas-bb3c1.firebaseapp.com",
            databaseURL: "https://reservamesas-bb3c1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "reservamesas-bb3c1",
            storageBucket: "reservamesas-bb3c1.firebasestorage.app",
            messagingSenderId: "818550369679",
            appId: "1:818550369679:web:d555d70417976812682ffa",
            measurementId: "G-SM7QF6JEXR"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Selección de elementos DOM
        const mesas = document.querySelectorAll('.mesa');
        const listaReservas = document.getElementById('lista-reservas');
        const botonAñadirReserva = document.getElementById('añadir-reserva');
        const botonResetMesas = document.getElementById('reset-mesas');

        // Cargar los datos desde Firebase
        function cargarDatos() {
            const mesasRef = ref(database, 'mesas');
            get(mesasRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const datosMesas = snapshot.val();
                    datosMesas.forEach(dato => {
                        const mesa = document.querySelector(`.mesa[data-nombre="${dato.nombre}"]`);
                        if (mesa) {
                            mesa.setAttribute('data-estado', dato.estado);
                            mesa.className = `mesa ${dato.estado}`;
                            mesa.innerHTML = `${dato.nombre}`;
                        }
                    });
                }
            }).catch((error) => {
                console.error("Error al cargar los datos:", error);
            });
        }

        // Función para guardar datos en Firebase
        function guardarDatos() {
            const datosMesas = [];
            mesas.forEach(mesa => {
                datosMesas.push({
                    nombre: mesa.getAttribute('data-nombre'),
                    estado: mesa.getAttribute('data-estado')
                });
            });

            const mesasRef = ref(database, 'mesas');
            set(mesasRef, datosMesas);
        }

        // Función para añadir una nueva reserva
        function añadirReserva() {
            const nombre = prompt('Nombre de la reserva:');
            const hora = prompt('Hora de la reserva (formato HH:MM):');

            if (nombre && hora) {
                const reserva = document.createElement('div');
                reserva.className = 'reserva';
                reserva.innerHTML = `
                    <span>${nombre} - ${hora}</span>
                    <button class="eliminar-reserva">Eliminar</button>
                `;
                reserva.querySelector('.eliminar-reserva').addEventListener('click', () => {
                    reserva.remove();
                    guardarDatos();
                });

                listaReservas.appendChild(reserva);
                guardarDatos();
            }
        }

        // Función para resetear las mesas
        function resetMesas() {
            mesas.forEach(mesa => {
                mesa.setAttribute('data-estado', 'libre');
                mesa.className = 'mesa libre';
                mesa.innerHTML = mesa.getAttribute('data-nombre');
            });
            guardarDatos();
        }

        // Evento para añadir una reserva
        botonAñadirReserva.addEventListener('click', añadirReserva);

        // Evento para resetear mesas
        botonResetMesas.addEventListener('click', resetMesas);

        // Cargar los datos al inicio
        cargarDatos();
    </script>
</body>
</html>
